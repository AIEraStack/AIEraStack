---
import Layout from '../../layouts/Layout.astro';
import { RepoAnalyzer } from '../../components/repo/RepoAnalyzer';
import { getCachedRepo } from '../../lib/data-loader';

export const prerender = false;

const { slug } = Astro.params;
const parts = slug?.split('/') || [];
const env = Astro.locals?.runtime?.env;

if (parts.length !== 2) {
  return Astro.redirect('/');
}

const [owner, name] = parts;
const cached = await getCachedRepo(owner, name, env);

const pageTitle = cached 
  ? `${cached.repo.name} - AI Era Stack`
  : `${owner}/${name} - AI Era Stack`;

const pageDescription = cached?.repo.description 
  ? `${cached.repo.description} - See how well AI models understand this project.`
  : `See how well AI models understand ${owner}/${name}`;

const defaultLlmId = 'gpt-5.2-codex';
---

<Layout title={pageTitle} description={pageDescription}>
  <div class="max-w-6xl mx-auto px-4 py-8">
    <a href="/" class="inline-flex items-center gap-2 text-slate-400 hover:text-white mb-6 transition-colors">
      ‚Üê Back to search
    </a>

    <RepoAnalyzer
      client:load
      owner={owner}
      name={name}
      initialData={cached}
      defaultLLMId={defaultLlmId}
    />
  </div>
</Layout>
